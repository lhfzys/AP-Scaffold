<UserControl x:Class="AP.Plugin.Dashboard.UI.Views.DashboardView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:prism="http://prismlibrary.com/"
             xmlns:md="http://materialdesigninxaml.net/winfx/xaml/themes"
             prism:ViewModelLocator.AutoWireViewModel="True">
    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Grid Grid.Row="0" Margin="0,0,0,24">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <StackPanel>
                <TextBlock Text="{Binding Title}" Style="{StaticResource MaterialDesignHeadline4TextBlock}"/>
                <TextBlock Text="设备实时通信状态监控" Style="{StaticResource MaterialDesignCaptionTextBlock}" Opacity="0.6"/>
            </StackPanel>

            <Button Grid.Column="1" Content="测试全局弹窗" Command="{Binding TestDialogCommand}" Style="{StaticResource MaterialDesignOutlinedButton}"/>
        </Grid>

        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="1*"/>
            </Grid.ColumnDefinitions>

            <md:Card Grid.Column="0" Margin="0,0,16,0" Padding="0" UniformCornerRadius="8" md:ElevationAssist.Elevation="Dp2" VerticalAlignment="Top">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <Border Background="{DynamicResource MaterialDesignPaper}" BorderBrush="{DynamicResource MaterialDesignDivider}" BorderThickness="0,0,0,1" Padding="16">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel>
                                <TextBlock Text="PLC 通信通道" Style="{StaticResource MaterialDesignHeadline6TextBlock}"/>
                                <TextBlock Text="{Binding LastPlcDevice}" Opacity="0.6"/>
                            </StackPanel>

                            <md:Chip Grid.Column="1" 
                                     Content="{Binding ConnectionStatusText}"
                                     Background="{Binding StatusColor}"
                                     Foreground="White">
                                <md:Chip.Icon>
                                    <md:PackIcon Kind="LanConnect" />
                                </md:Chip.Icon>
                            </md:Chip>
                        </Grid>
                    </Border>

                    <StackPanel Grid.Row="1">
                        <Button Content="手动连接 PLC"
                                Command="{Binding ManualConnectCommand}"
                                Style="{StaticResource MaterialDesignOutlinedButton}"
                                Margin="0,16,0,0"
                                HorizontalAlignment="Center">
                            <Button.IsEnabled>
                                <Binding Path="IsPlcConnected" Converter="{StaticResource InverseBoolToVis}"/>
                            </Button.IsEnabled>
                            <Button.Visibility>
                                <Binding Path="IsPlcConnected" Converter="{StaticResource InverseBoolToVis}"/>
                            </Button.Visibility>
                        </Button>
                        <TextBlock Text="当前监测值" Opacity="0.5" HorizontalAlignment="Center"/>
                        <TextBlock Text="{Binding LastPlcValue}" 
                                   Style="{StaticResource MaterialDesignHeadline2TextBlock}" 
                                   FontWeight="Bold" 
                                   Foreground="{DynamicResource PrimaryHueMidBrush}"
                                   HorizontalAlignment="Center"
                                   Margin="0,8"/>

                        <Grid Margin="0,16,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition/>
                                <ColumnDefinition/>
                            </Grid.ColumnDefinitions>
                            <StackPanel HorizontalAlignment="Center">
                                <TextBlock Text="Tag 地址" Opacity="0.5"/>
                                <TextBlock Text="{Binding LastPlcAddress}" FontWeight="Bold"/>
                            </StackPanel>
                            <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                                <TextBlock Text="更新时间" Opacity="0.5"/>
                                <TextBlock Text="{Binding LastPlcTime, StringFormat=HH:mm:ss.fff}" FontWeight="Bold"/>
                            </StackPanel>
                        </Grid>
                    </StackPanel>

                    <ProgressBar Grid.Row="2" Height="4" IsIndeterminate="True" 
                                 Visibility="{Binding IsPlcConnected, Converter={StaticResource BoolToVis}}"/>
                </Grid>
            </md:Card>

            <md:Card Grid.Column="1" Padding="16" VerticalAlignment="Top">
                <StackPanel>
                    <TextBlock Text="操作日志" Style="{StaticResource MaterialDesignHeadline6TextBlock}" Margin="0,0,0,8"/>
                    <TextBlock Text="系统初始化完成..." Opacity="0.6"/>
                    <TextBlock Text="等待 PLC 连接..." Opacity="0.6"/>
                </StackPanel>
            </md:Card>
        </Grid>
    </Grid>
</UserControl>
