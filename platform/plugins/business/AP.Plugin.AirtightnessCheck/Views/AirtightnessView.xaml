<UserControl x:Class="AP.Plugin.AirtightnessCheck.Views.AirtightnessView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:prism="http://prismlibrary.com/"
             xmlns:md="http://materialdesigninxaml.net/winfx/xaml/themes"
             prism:ViewModelLocator.AutoWireViewModel="True">
    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <md:Card Grid.Row="0" Margin="0,0,0,16" Background="{Binding StateColor}" Foreground="White" md:ElevationAssist.Elevation="Dp3" UniformCornerRadius="8">
            <Grid>
                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                    <TextBlock Text="{Binding TestStateText}" 
                               FontSize="48" 
                               FontWeight="Bold" 
                               HorizontalAlignment="Center"
                               FontFamily="Microsoft YaHei UI"/>
                </StackPanel>
            </Grid>
        </md:Card>

        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="1*"/>
            </Grid.ColumnDefinitions>

            <md:Card Grid.Column="0" Margin="0,0,16,0" Padding="32" md:ElevationAssist.Elevation="Dp2" UniformCornerRadius="8">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <StackPanel Grid.Row="0" HorizontalAlignment="Center" VerticalAlignment="Center">
                        <TextBlock Text="测试压力 (kPa)" Opacity="0.6" HorizontalAlignment="Center" FontSize="18"/>
                        <TextBlock Text="{Binding CurrentPressure, StringFormat={}{0:F2}}" 
                                   FontSize="80" 
                                   FontWeight="Light" 
                                   HorizontalAlignment="Center" 
                                   Foreground="{DynamicResource PrimaryHueMidBrush}"/>
                    </StackPanel>

                    <Separator Grid.Row="1" Margin="32,0" Background="{DynamicResource MaterialDesignDivider}"/>

                    <StackPanel Grid.Row="2" HorizontalAlignment="Center" VerticalAlignment="Center">
                        <TextBlock Text="泄漏率 (Pa/s)" Opacity="0.6" HorizontalAlignment="Center" FontSize="18"/>
                        <TextBlock Text="{Binding LeakRate, StringFormat={}{0:F1}}" 
                                   FontSize="80" 
                                   FontWeight="SemiBold" 
                                   HorizontalAlignment="Center"
                                   Foreground="{Binding StateColor}"/>
                    </StackPanel>
                </Grid>
            </md:Card>

            <md:Card Grid.Column="1" Padding="24" md:ElevationAssist.Elevation="Dp2" UniformCornerRadius="8">
                <StackPanel>
                    <TextBlock Text="测试参数" Style="{StaticResource MaterialDesignHeadline5TextBlock}" Margin="0,0,0,24"/>

                    <Grid Margin="0,0,0,16">
                        <TextBlock Text="当前配方" Opacity="0.6" VerticalAlignment="Center"/>
                        <md:Chip Content="{Binding CurrentRecipe}" HorizontalAlignment="Right" Background="{DynamicResource SecondaryHueMidBrush}" Foreground="White"/>
                    </Grid>

                    <Separator Margin="0,8"/>

                    <Grid Margin="0,16">
                        <TextBlock Text="目标压力 (kPa)" Opacity="0.6" VerticalAlignment="Center" FontSize="16"/>
                        <TextBlock Text="{Binding TargetPressure, StringFormat={}{0:F1}}" FontWeight="Bold" FontSize="20" HorizontalAlignment="Right"/>
                    </Grid>
                    <ProgressBar Minimum="0" Maximum="{Binding TargetPressure}" Value="{Binding CurrentPressure}" Height="8" Foreground="{DynamicResource PrimaryHueMidBrush}"/>

                    <Grid Margin="0,24,0,16">
                        <TextBlock Text="报警泄漏上限 (Pa/s)" Opacity="0.6" VerticalAlignment="Center" FontSize="16"/>
                        <TextBlock Text="{Binding AlarmLeakRate, StringFormat={}{0:F1}}" FontWeight="Bold" FontSize="20" HorizontalAlignment="Right" Foreground="Red"/>
                    </Grid>

                    <Border Background="#10000000" CornerRadius="4" Padding="16" Margin="0,32,0,0">
                        <TextBlock Text="提示：系统已与检具硬件连接，正在监听串口流数据..." TextWrapping="Wrap" Opacity="0.5"/>
                    </Border>
                </StackPanel>
            </md:Card>
        </Grid>

        <md:Card Grid.Row="2" Margin="0,16,0,0" Padding="16" md:ElevationAssist.Elevation="Dp2" UniformCornerRadius="8">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">

                <md:PackIcon Kind="BarcodeScan" VerticalAlignment="Center" Margin="0,0,8,0" Opacity="0.5"/>
                <TextBox md:HintAssist.Hint="等待扫描条码..." Width="200" VerticalAlignment="Center" Margin="0,0,24,0" IsEnabled="False"/>

                <Button Content="手动测试" 
                        Command="{Binding StartTestCommand}" 
                        Style="{StaticResource MaterialDesignRaisedButton}" 
                        Width="120" Height="40" Margin="0,0,16,0"/>

                <Button Content="复位" 
                        Command="{Binding ResetCommand}" 
                        Style="{StaticResource MaterialDesignOutlinedButton}" 
                        Width="100" Height="40"/>
            </StackPanel>
        </md:Card>
    </Grid>
</UserControl>
