<UserControl x:Class="AP.Plugin.AirtightnessCheck.Views.AirtightnessView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:prism="http://prismlibrary.com/"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             prism:ViewModelLocator.AutoWireViewModel="True">
    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <ItemsControl 
ItemsSource="{Binding Steps}" 
Margin="0,0,0,4"
HorizontalAlignment="Center">
            <ItemsControl.Resources>
                <LinearGradientBrush x:Key="CurrentStepGradient" StartPoint="0,0.5" EndPoint="1,0.5">
                    <GradientStop Color="#009688" Offset="0.0" />
                    <GradientStop Color="#FFA500" Offset="1.0" />
                </LinearGradientBrush>
            </ItemsControl.Resources>
            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <UniformGrid Rows="1"/>
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>

            <ItemsControl.ItemTemplate>
                <DataTemplate>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*" MinWidth="120"/>
                        </Grid.ColumnDefinitions>

                        <!-- ================= 左侧步骤节点 ================= -->
                        <StackPanel Grid.Column="0" Orientation="Horizontal">

                            <!-- 圆点 -->
                            <Border Width="32" Height="32"
                        CornerRadius="16"
                        BorderThickness="1"
                        VerticalAlignment="Center">

                                <Border.Style>
                                    <Style TargetType="Border">

                                        <!-- 未开始 -->
                                        <Setter Property="Background"
                                    Value="{DynamicResource Brush.Inactive}"/>
                                        <Style.Triggers>

                                            <!-- 当前步骤 -->
                                            <DataTrigger Binding="{Binding IsCurrent}" Value="True">
                                                <Setter Property="Background"
                                            Value="{DynamicResource MaterialDesign.Brush.Primary}"/>
                                            </DataTrigger>

                                            <!-- 已完成 -->
                                            <DataTrigger Binding="{Binding IsCompleted}" Value="True">
                                                <Setter Property="Background"
                                            Value="{DynamicResource Brush.Success}"/>
                                            </DataTrigger>

                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>

                                <!-- 圆内文字 -->
                                <TextBlock HorizontalAlignment="Center"
                               VerticalAlignment="Center"
                               FontWeight="Bold">

                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">

                                            <!-- 默认：未开始 -->
                                            <Setter Property="Text" Value="{Binding StepNumber}"/>
                                            <Setter Property="Foreground"
                                        Value="{DynamicResource MaterialDesign.Brush.OnSurface}"/>
                                            <Setter Property="FontSize" Value="16"/>

                                            <Style.Triggers>

                                                <!-- 当前 -->
                                                <DataTrigger Binding="{Binding IsCurrent}" Value="True">
                                                    <Setter Property="Foreground"
                                                Value="{DynamicResource MaterialDesign.Brush.OnPrimary}"/>
                                                </DataTrigger>

                                                <!-- 完成 -->
                                                <DataTrigger Binding="{Binding IsCompleted}" Value="True">
                                                    <Setter Property="Text" Value="✓"/>
                                                    <Setter Property="FontSize" Value="18"/>
                                                    <Setter Property="Foreground"
                                                Value="{DynamicResource Brush.OnSuccess}"/>
                                                </DataTrigger>

                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </Border>

                            <!-- 步骤标题 -->
                            <TextBlock Text="{Binding Header}"
                           Margin="12,0,16,0"
                           VerticalAlignment="Center"
                           FontSize="16">

                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">

                                        <!-- 未开始 -->
                                        <Setter Property="Foreground"
                                    Value="{DynamicResource MaterialDesign.Brush.OnSurface}"/>
                                        <Setter Property="FontWeight" Value="Regular"/>

                                        <Style.Triggers>

                                            <!-- 当前 -->
                                            <DataTrigger Binding="{Binding IsCurrent}" Value="True">
                                                <Setter Property="Foreground"
                                            Value="{DynamicResource MaterialDesign.Brush.Primary}"/>
                                                <Setter Property="FontWeight" Value="Bold"/>
                                            </DataTrigger>

                                            <!-- 已完成 -->
                                            <DataTrigger Binding="{Binding IsCompleted}" Value="True">
                                                <Setter Property="Foreground"
                                            Value="{DynamicResource MaterialDesign.Brush.OnSurfaceVariant}"/>
                                            </DataTrigger>

                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>

                        </StackPanel>

                        <!-- ================= 连接线 ================= -->
                        <Border Grid.Column="1" Height="2" Margin="16,0,24,0" VerticalAlignment="Center">
                            <Border.Style>
                                <Style TargetType="Border">
                                    <Setter Property="Background" Value="{DynamicResource MaterialDesign.Brush.Primary.Light}"/>
                                    <Setter Property="Visibility" Value="Visible"/>

                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsCurrent}" Value="True">
                                            <Setter Property="Background" Value="{DynamicResource CurrentStepGradient}" />
                                        </DataTrigger>

                                        <DataTrigger Binding="{Binding IsCompleted}" Value="True">
                                            <Setter Property="Background" Value="{DynamicResource  MaterialDesign.Brush.Primary}"/>
                                        </DataTrigger>

                                        <DataTrigger Binding="{Binding IsLastStep}" Value="True">
                                            <Setter Property="Visibility" Value="Hidden"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>
                        </Border>
                    </Grid>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>

        <!-- ================= 操作按钮 ================= -->
        <StackPanel Grid.Row="1"
        Orientation="Horizontal"
        HorizontalAlignment="Right"
        >

            <Button Content="上一步"
        Command="{Binding PrevStepCommand}"
        Style="{StaticResource MaterialDesignOutlinedButton}"
        Width="120"
        Height="40"
        Margin="0,0,16,0"/>

            <Button Content="下一步"
        Command="{Binding NextStepCommand}"
        Style="{StaticResource MaterialDesignRaisedButton}"
        Width="120"
        Height="40"/>
        </StackPanel>
    </Grid>
</UserControl>
